<div class="container mx-auto p-4">
  <!-- Header -->
  <div class="mb-6">
    <h1 class="text-3xl font-bold text-gray-800 mb-2">My Orders</h1>
    <p class="text-gray-600">Manage and review the status of your orders</p>
  </div>

  <!-- Filters -->
  <p-card class="mb-6">
    <ng-template pTemplate="header">
      <div class="flex items-center gap-2">
        <i class="pi pi-filter text-lg"></i>
        <span class="font-semibold">Filters</span>
      </div>
    </ng-template>
    
    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
      <!-- Text search -->
      <div class="flex flex-col">
        <label for="search" class="text-sm font-medium text-gray-700 mb-1">Search</label>
        <input
          id="search"
          pInputText
          [(ngModel)]="searchValue"
          placeholder="Order number or address..."
          class="w-full"
          (input)="applyFilters()"
        />
      </div>

      <!-- Date from -->
      <div class="flex flex-col">
        <label for="dateFrom" class="text-sm font-medium text-gray-700 mb-1">From</label>
        <p-datepicker
          [(ngModel)]="dateFrom"
          placeholder="From date"
          dateFormat="dd/mm/yy"
          class="w-full"
          (onSelect)="applyFilters()"
          (onClearClick)="applyFilters()"
        />
      </div>

      <!-- Date to -->
      <div class="flex flex-col">
        <label for="dateTo" class="text-sm font-medium text-gray-700 mb-1">To</label>
        <p-datepicker
          [(ngModel)]="dateTo"
          placeholder="To date"
          dateFormat="dd/mm/yy"
          class="w-full"
          (onSelect)="applyFilters()"
          (onClearClick)="applyFilters()"
        />
      </div>

      <!-- Clear filters button -->
      <div class="flex flex-col justify-end">
        <p-button
          label="Clear Filters"
          icon="pi pi-times"
          severity="secondary"
          (onClick)="clearFilters()"
          class="w-full"
        />
      </div>
    </div>
  </p-card>

  <!-- Orders table -->
  <p-card>
    <ng-template pTemplate="header">
      <div class="flex justify-between items-center">
        <div class="flex items-center gap-2">
          <i class="pi pi-shopping-cart text-lg"></i>
          <span class="font-semibold">Orders ({{ filteredOrders.length }})</span>
        </div>
        <p-button
          icon="pi pi-refresh"
          severity="secondary"
          (onClick)="loadOrders()"
          [loading]="loading"
          pTooltip="Refresh"
        />
      </div>
    </ng-template>

    <!-- Loading skeleton -->
    <div *ngIf="loading" class="space-y-4">
      <p-skeleton height="4rem" *ngFor="let item of [1,2,3,4,5]"></p-skeleton>
    </div>

    <!-- Table -->
    <p-table 
      *ngIf="!loading"
      [value]="filteredOrders"
      [paginator]="true"
      [rows]="10"
      [showCurrentPageReport]="true"
      currentPageReportTemplate="Showing {first} to {last} of {totalRecords} orders"
      [rowsPerPageOptions]="[5,10,20]"
      styleClass="p-datatable-striped"
    >
      <!-- Order Number Column -->
      <ng-template pTemplate="header">
        <tr>
          <th>Number</th>
          <th>Date</th>
          <th>Status</th>
          <th>Total</th>
          <th>Address</th>
          <th>Products</th>
          <th>Actions</th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-order>
        <tr>
          <!-- Order number -->
          <td>
            <div class="font-medium text-blue-600">{{ order.orderNumber }}</div>
            <div class="text-xs text-gray-500">ID: {{ order.id }}</div>
          </td>

          <!-- Date -->
          <td>
            <div class="text-sm">{{ formatDate(order.orderDate) }}</div>
            <div class="text-xs text-gray-500" *ngIf="order.estimatedDeliveryDate">
              Delivery: {{ formatDate(order.estimatedDeliveryDate) }}
            </div>
          </td>

          <!-- Status -->
          <td>
            <p-tag 
              [severity]="getStatusSeverity(order.status)"
              [value]="getStatusLabel(order.status)"
              class="text-sm"
            />
          </td>

          <!-- Total -->
          <td>
            <div class="font-semibold text-green-600">
              {{ formatCurrency(order.totalAmount) }}
            </div>
          </td>

          <!-- Address -->
          <td>
            <div class="max-w-xs truncate" [title]="order.deliveryAddress">
              {{ order.deliveryAddress }}
            </div>
          </td>

          <!-- Products -->
          <td>
            <div class="space-y-1">
              <div 
                *ngFor="let product of order.products" 
                class="text-sm bg-gray-100 rounded px-2 py-1"
              >
                <div class="font-medium">{{ product.productName }}</div>
                <div class="text-xs text-gray-600">
                  Quantity: {{ product.quantity }} | 
                  {{ formatCurrency(product.unitPrice) }} each
                </div>
              </div>
            </div>
          </td>

          <!-- Actions -->
          <td>
            <div class="flex gap-2">
              <!-- Cancel button -->
              <p-button
                *ngIf="canCancelOrder(order.status)"
                icon="pi pi-times"
                severity="danger"
                size="small"
                (onClick)="cancelOrder(order)"
                pTooltip="Cancel order"
                [outlined]="true"
              />

              <!-- No action available indicator -->
              <span 
                *ngIf="!canCancelOrder(order.status)"
                class="text-xs text-gray-500 px-2 py-1"
              >
                Not available
              </span>
            </div>
          </td>
        </tr>
      </ng-template>

      <!-- Empty state -->
      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="7" class="text-center py-8">
            <div class="flex flex-col items-center">
              <i class="pi pi-shopping-cart text-4xl text-gray-400 mb-4"></i>
              <p class="text-gray-500 text-lg">You don't have any orders yet</p>
              <p class="text-gray-400 text-sm">When you place an order, it will appear here</p>
            </div>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </p-card>
</div>

<!-- Toast Messages -->
<p-toast />

<!-- Confirmation Dialog -->
<p-confirmDialog />
