<div class="p-4 products-container">
  <!-- Vista de detalle de producto individual -->
  <div *ngIf="showProductDetail && selectedProduct" class="product-detail-view">
    <div class="mb-4">
      <p-button 
        icon="pi pi-arrow-left" 
        label="Return to products" 
        (click)="backToProductsList()"
        styleClass="p-button-outlined">
      </p-button>
    </div>
    
    <app-product 
      [product]="selectedProduct" 
      (addToCartEvent)="onAddToCart($event)">
    </app-product>
  </div>

  <!-- Vista de lista de productos -->
  <div *ngIf="!showProductDetail" class="products-list-view">
    <!-- Header -->
    <div class="mb-6">
      <h1 class="mb-2 text-3xl font-bold text-gray-800 dark:text-white">Our Products</h1>
      <p class="text-gray-600 dark:text-gray-300">Explore our wide selection of products</p>
    </div>

    <!-- Filtros y búsqueda -->
    <div class="p-4 mb-6 bg-white rounded-lg shadow-md filters-section dark:bg-gray-800">
      <div class="grid grid-cols-1 gap-4 md:grid-cols-2">
        <!-- Búsqueda -->
        <div class="search-container">
          <label for="search" class="block mb-2 text-sm font-medium text-gray-700 dark:text-gray-300">
            Search products
          </label>
          <span class="w-full p-input-icon-left">
            <i class="pi pi-search"></i>
            <input 
              type="text" 
              pInputText 
              id="search"
              [(ngModel)]="searchTerm" 
              (input)="onSearchChange()"
              placeholder="Search by name or description..."
              class="w-full" />
          </span>
        </div>

        <!-- Filtro por categoría -->
        <div class="category-filter">
          <label for="category" class="block mb-2 text-sm font-medium text-gray-700 dark:text-gray-300">
            Filter by category
          </label>
          <select 
            id="category"
            [(ngModel)]="selectedCategory"
            (change)="onCategoryChange()"
            class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white">
            <option *ngFor="let category of categories" [value]="category.value">
              {{ category.label }}
            </option>
          </select>
        </div>
      </div>

      <!-- Resultados counter -->
      <div class="mt-4 text-sm text-gray-600 dark:text-gray-400">
        Showing {{ filteredProducts.length }} of {{ products.length }} products
      </div>
    </div>

    <!-- Grid de productos -->
    <div class="products-grid">
      <!-- Mensaje si no hay productos -->
      <div *ngIf="filteredProducts.length === 0" class="py-8 text-center no-products-message">
        <i class="mb-4 text-4xl text-gray-400 pi pi-search"></i>
        <h3 class="mb-2 text-xl font-semibold text-gray-600 dark:text-gray-300">
          No se encontraron productos
        </h3>
        <p class="text-gray-500 dark:text-gray-400">
          Intenta ajustar tus filtros de búsqueda
        </p>
      </div>

      <!-- Lista de productos -->
      <div class="grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4" *ngIf="filteredProducts.length > 0">
        <div 
          *ngFor="let product of filteredProducts" 
          class="product-card"
          (click)="showProductDetails(product)">
          
          <p-card styleClass="h-full cursor-pointer hover:shadow-lg transition-shadow duration-300">
            <!-- Imagen del producto -->
            <div class="mb-4 product-image-container">
              <div class="flex items-center justify-center w-full h-48 overflow-hidden bg-gray-100 rounded-lg dark:bg-gray-700">
                <img
                  [src]="product.imageUrl"
                  [alt]="product.name"
                  class="object-cover w-full h-full"
                  style="max-width: 80%; max-height: 100%;"
                  />
              </div>
            </div>

            <!-- Información del producto -->
            <div class="product-info">
              <h3 class="mb-2 text-lg font-semibold text-gray-800 dark:text-white line-clamp-2">
                {{ product.name }}
              </h3>
              
              <p class="mb-3 text-sm text-gray-600 dark:text-gray-300 line-clamp-2" *ngIf="product.description">
                {{ product.description }}
              </p>

              <!-- Precio y acciones -->
              <div class="flex items-center justify-between mt-4">
                <div class="price">
                  <span class="text-2xl font-bold text-blue-600 dark:text-blue-400">
                    ${{ product.price }}
                  </span>
                </div>
                
                <p-button
                  icon="pi pi-eye"
                  label="See more"
                  styleClass="p-button-sm p-button-outlined"
                  (click)="showProductDetails(product); $event.stopPropagation()">
                </p-button>
              </div>
            </div>

            <!-- Tag de categoría -->
            <p-tag 
              *ngIf="product.category"
              [value]="product.category.name"
              severity="info"
              styleClass="absolute top-2 right-2 text-xs">
            </p-tag>
          </p-card>
        </div>
      </div>
    </div>

    <!-- Loading state -->
    <div *ngIf="products.length === 0" class="py-8 text-center loading-state">
      <i class="mb-4 text-3xl text-blue-500 pi pi-spin pi-spinner"></i>
      <p class="text-gray-600 dark:text-gray-300">Cargando productos...</p>
    </div>
  </div>
</div>
